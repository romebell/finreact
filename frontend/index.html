<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="./css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Jura:700|Roboto:100,300,400,500" rel="stylesheet">
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMi2fDeIUk6NxNjFeyHEebaeEmku5OSBo&libraries=visualization" type="text/javascript"></script>
  <script src="./js/map.js" type="text/javascript"></script>
  <!-- <script src="/app/assets/javascripts/bundle.js"></script> -->
  <title>Geo Tweet</title>
</head>
<body onload="initMap()">
  <div class="container">
    <div id="map"></div>
    <div class="body-container">
      <div class="header-container">
        <h1>Geo Tweet</h1>
        <div id="blurb">Real time tweets from around the world.</div>
        <div id="about">Geo Tweet is a app that streams realtime tweets from Twitter's API and maps the coordinates of where the tweets are posted from. A heatmap is generated based on the concentration of tweets coming from a specific geolocation. Click on the blue dots to read tweets coming in from around the world!</div>
      </div>
      
      <div class="tweet-container">
        <div id="tweet-stream">Now streaming:</div>
        <ul class="tweets">
              <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
              <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
              <script>
                  let socket = io();
                  let tweetArray = [];
                  let index = 0;
                  
                  socket.on('tweet', function (tweet) {
                     console.log('connected inside of tweet');
                     /* let tweetbody;
                      if (tweet.tweet.place != undefined) {
                        tweetbody = {
                          'text': tweet.tweet.text,
                          'userScreenName': "@" + tweet.tweet.user.screen_name,
                          'userImage': tweet.tweet.user.profile_image_url_https,
                          'userDescription': tweet.tweet.user.description,
                          'coords': tweet.tweet.place.bounding_box.coordinates[0][0],
                        }
                        try {
                          if (tweet.tweet.entities.media[0].media_url_https) {
                            tweetbody['image'] = tweet.tweet.entities.media[0].media_url_https;
                          }
                        } catch (err) { }
                        tweetArray.unshift(tweetbody);
                      }*/
                      let currentTweet = tweet.tweet;
                      let tweetContent = $('ul.tweets');
                      let screenName = '<div id="name">' + currentTweet.userScreenName + '</div>';
                      let username = '<div id="username">' + '@' + currentTweet.userScreenName + '</div>';
                      let userImage = `<img id="prof-pic" src="${currentTweet.userImage}"/>`;

                      tweetContent.prepend(
                        '<li>' 
                          + '<div id="prof-info">' 
                            + userImage 
                            + '<div id="prof-names">' 
                              + screenName 
                              + username 
                            + '</div>' 
                          + '</div>' + currentTweet.text + 
                        '</li>')
                      // tweetArray.unshift(tweet);
                      socket.emit('tweetArray', tweetArray)
                  })
            
                  /*socket.on('tweetArray', function (tweet) {
                    console.log('socket.on for tweet inside index.html');
                      tweetArray = tweet;
                      //console.log(tweetArray);
                      loopArray();
                      window.tweetArray = tweetArray;
                      // console.log(tweetArray);
                      socket.emit('tweet', tweetArray);
                  });

                  function loopArray() {
                    if (tweetArray.length > index) {
                      let currentTweet = tweetArray[index];
                      let tweetContent = $('ul.tweets');
                      //console.log(currentTweet);
                      index++;

                      let screenName = '<div id="name">' + currentTweet.userScreenName + '</div>';
                      let username = '<div id="username">' + '@' + currentTweet.userScreenName + '</div>';
                      let userImage = `<img id="prof-pic" src="${currentTweet.userImage}"/>`;

                      //  console.log(screenName);

                      tweetContent.prepend(
                        '<li>' 
                          + '<div id="prof-info">' 
                            + userImage 
                            + '<div id="prof-names">' 
                              + screenName 
                              + username 
                            + '</div>' 
                          + '</div>' + currentTweet.text + 
                        '</li>');
                      
                    } else {
                      index = 0;
                    }
                    setTimeout(loopArray, 1000);
                  }*/
                </script>
            </ul>
          </div>
        </div>
      </div>
</body>
</html>

